---
title: "Tanzania Market Survey C: Descriptive Analysis"
author: "Beth Savagar"
date: "2024-01-25"
output:
  html_document: 
    toc: true
    toc_depth: 2
    df_print: paged

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include = F}
library(readr)
library(tidyverse)
library(sf)
library(ggplot2)
library(here)
library(knitr)
library(ggpubr)
library(RColorBrewer)

```

```{r theme, include = F}
custom_theme <- theme_bw() + 
  theme(text = element_text(family = "Times New Roman", size = 10))
theme_set(custom_theme)

tanzania_pal <- rep(brewer.pal(9,"Pastel1"),times=4)
market_pal <- c(brewer.pal(8, "Dark2"), "#FFA500", "#6A3D9A", "#33A02C")
```

```{r load-data, include = F}
#tanzania map: 

# tdists_shp <- st_read(here("data/shapefiles/tza_admbnda_adm2_20181019.shp")) # with district boundaries
tregs_shp <- st_read(here("data/shapefiles/tza_admbnda_adm1_20181019.shp")) %>% # with region boundaries
   rename(
    "Country_N"=ADM0_EN,    
    "Country_NSw" = ADM0_SW,
    "Country_C"=ADM0_PCODE,
    "Region_Nam" = ADM1_EN,
    "Region_Cod" = ADM1_PCODE,
  )

twards_shp <- st_read(here("data/shapefiles/tza_admbnda_adm3_20181019.shp")) %>% # with ward boundaries
    rename(
    "Country_N"=ADM0_EN,    
    "Country_NSw" = ADM0_SW,
    "Country_C"=ADM0_PCODE,
    "Region_Nam" = ADM1_EN,
    "Region_Cod" = ADM1_PCODE,
    "District_N" = ADM2_EN,
    "District_C" = ADM2_PCODE,
    "Ward_Name"=ADM3_EN,
    "Ward_Code"= ADM3_PCODE
  )

mrkta_gps <- read_csv(here("data/tanzania_data/mrkta_gps_tanzania_final.csv"))
mrktc_gps <- read_csv(here("data/tanzania_data/mrktc_allgps_tanzania_final.csv"))

# mrkta_generalinfo, need to link to cleaned update market location data
mrktc_info_CLEAN <-  read_csv(here("data/data-cleaning_data/mrktc_generalinfo_tanzania_CLEAN.csv"))

# link mrktc Info to clean gps data and retain only variables of interest
mrktc_info <- left_join(
  mrktc_info_CLEAN %>% select(-c(contains(".code"), contains(".name"), contains("village"))),
  mrktc_gps %>% select(-c(country, uniqueMrkt.check)),
  by = c("fid","date", "unique.row.identifier.uuid.")) %>% # can't join by "gps.coordinates.of.the.market" as some rows of original data have no location.
  select(
    fid,
    contains("date"),
    country,
    ends_with(".check"),
    everything(),
    gps.coordinates.of.the.market.check = gps.coordinates.of.the.market.y,
    unique.row.identifier.uuid.
  )

```

# Map of Survey C Locations
- Triangles indicate market survey C locations
- Circles indicate market survey A locations

```{r mrktcMap, include = F}

# Market A Map Data
mrkta_mapdata <- mrkta_gps %>%
  mutate(lat = str_split(`gps.coordinates.of.the.market`, "\\s", simplify = TRUE)[, 1],
         long = str_split(`gps.coordinates.of.the.market`, "\\s", simplify = TRUE)[, 2]) %>%
  filter(!is.na(lat), !is.na(long))

mrkta_sf <- st_as_sf(mrkta_mapdata, coords = c("long","lat"),  crs = 4326)

# Market C Map Data  
mrktc_mapdata <- mrktc_gps %>% 
  mutate(lat = str_split(`gps.coordinates.of.the.market`, "\\s", simplify = TRUE)[, 1],
         long = str_split(`gps.coordinates.of.the.market`, "\\s", simplify = TRUE)[, 2]) %>% 
  filter(!is.na(lat), !is.na(long))

mrktc_sf <- st_as_sf(mrktc_mapdata, coords = c("long","lat"),  crs = 4326)

Regions_Cmanual <- mrktc_sf %>% pull(region.check) %>% unique() %>% str_to_title()

mrktc_mapByReg <- ggplot() +
  geom_sf(data = tregs_shp, fill = "grey", alpha = 0.5, linewidth = 0.1) +
  geom_sf(data = tregs_shp %>% filter(Region_Nam %in% Regions_Cmanual), aes(fill = Region_Nam),alpha = 0.5, linewidth = 0.1) +
  geom_sf(data = mrkta_sf, aes(col = region.geomatch.final), alpha = 0.5, size = 3)+
   geom_sf(data = mrktc_sf, aes(col = region.check),  shape = 17, size = 1.5)+
  geom_sf_text(data = tregs_shp, aes(label = Region_Nam), size = 2)+
  scale_fill_manual(values=rep(market_pal,2), guide = "none")+
  scale_colour_manual(values = rep(market_pal,2))+
  coord_sf()+
  labs(title = "Market survey C locations",
       fill = "Tanzania region",
       col = "Market region")+
  theme(legend.position = "right", legend.box = "horizontal")

```

```{r mapPrint, echo = F, warning= F}
mrktc_mapByReg
```

# Market Survey C Data: Overview

- Market survey C is the buyer-seller questionnaire
- There is one row per survey.
- The "General Information" section contains details about: ...
- The "Market Activities" section contains details about:

*From the EcoPPR Field Guide:*

- Questionnaire by face-to-face interview with individual people who are buying and/or selling animals in the market, about the sources and destinations of the animals, the reasons for buying and/or selling, transport method, trading patterns and disease problems.

**Methods**
- A minimum of 20 people should be interviewed, or 10% of the people buying and/or selling in the market, whichever is greater, depending on the size of the market. 
- The people to be interviewed should be selected randomly or
systematically to obtain a representative sample of all types of buyer and
sellers and to avoid bias. 
    - The research team for each country should discuss how their markets are laid out and make a plan of how to obtain an unbiased sample. 
    - If the markets are laid out in a rectangular enclosure, then the field team should walk a transect from one corner of the market, diagonally across the market area to the opposite corner, interviewing every person buying and selling that they meet along the transect. Having completed one transect, if more interviews are required, a second transect can be made starting in a different corner. 
    - If the market is circular with all the people buying and selling arranged around the edge with very few in the middle, then the team can start at one point and move around the edge of the circle, interviewing everyone that they meet. 
    - Having completed the transects or circle, it may become clear that some key types of buyers or sellers have been missed e.g. sometimes the commercial traders are very busy and moving quickly in the market place so the team has not managed to meet many during the transect. In this case, they can be purposively tracked down for interview in addition to the 20 people/10% people interviewed in the main market area

<br>

## 1) What fields are contained in the cleaned survey data? {#fields}

- Market survey identifiers: date, location data
- Market info: market type, respondent role (trader or otherwise), number of markets visited

```{r raw_fields, echo = F, warning = F}

# Fields contained in market A data:
colnames(mrktc_info)
```

## 2) How many surveys are there, in total?
- How many surveys were completed?
- How many surveys were completed at each market?
- *Each row of data corresponds to a unique market survey (C)*
- *Each survey is associated with a unique market name, which can be used to group data*

```{r num_mrkts, echo =F, warning=F}

# Check market names are unique:
# mrktc_info %>% distinct(region.check,district.check,ward.check,village.check,market.check) %>% nrow()
# mrktc_info %>% distinct(market.check) %>% nrow()

mrktc_info <- mrktc_info %>%
  mutate(uniqueMrkt = paste(region.check,district.check,ward.check,village.check,market.check, sep = "-"))

num_srvy <- nrow(mrktc_info)
print(paste("There are ", num_srvy, " rows of data corresponding to unique surveys."))

# Distinct market names (can be used as identifier):
num_mrkt <- mrktc_info %>% distinct(uniqueMrkt) %>% nrow()
print(paste("There are ", num_mrkt, " unique markets"))

```

## 3) Surveys per Market {.tabset}
*How many surveys were completed at each Market?*

### Surveys per Market:
- According to field design there should be a minimum of 20 surveys conducted at each market.
- This is true for most markets except those in Mtwara, Ruvuma and Lindi
  - Ruvuma and Lindi markets are on boundary/visited due to vicinity to Mtwara. 

```{r srvypermrkt}

srvyCount <- mrktc_info %>% group_by(region.check, uniqueMrkt) %>% count() 
srvyCount %>% paged_table()

mrktc_info %>% group_by(region,uniqueMrkt) %>% count() %>% filter(n<20) %>% paged_table()


# distribution of surveys at each market
ggplot(srvyCount, aes(x=n))+
  geom_histogram(binwidth = 5)

# excluding mtwara:
ggplot(srvyCount %>% filter(region.check != "mtwara"), aes(x=n))+
  geom_histogram(binwidth = 5)
```


### Surveys per Market - byRegion (boxplot)
```{r salesRegBox, echo = F}

# function for number of observations
give.n <- function(x){
  return(c(y = max(x)*1.1, label = length(x)))
  # experiment with the multiplier to find the perfect position
}

# plot
# median number of surveys at each market, grouped by region:

ggplot(srvyCount,
       # reorder(Species, Sepal.Width, FUN = median)
       aes(x=reorder(region.check,-n,FUN=median, desc.=F), y=n))+
  geom_boxplot(aes(fill = region.check), alpha = 0.5)+
  geom_jitter(position = position_dodge(width = 0))+
  geom_hline(yintercept = 20, linetype = "dashed")+
  scale_fill_manual(values = rep(market_pal,2))+
  stat_summary(fun.data = give.n, geom = "text", fun.y = max)+
  labs(x="Region", y = "Surveys per market")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none")

```

<!-- ### Surveys per Region: -->
<!--   - NB: first 6 regions are targeted regions: -->
<!--   - *Why is the number of surveys so uneven?* -->
<!--     - DM suggested that the different number of surveys in each region just reflects the different number of markets in those regions (some have many, others have few) -->

<!-- ```{r mrkt_region, echo = F} -->

<!-- mrktregion_count <- mrkta_info %>% group_by(region.geomatch.final) %>% count() %>%  -->
<!--   mutate("target" = ifelse(`region.geomatch.final` %in% c("katavi", "simiyu", "mbeya", "mtwara", "morogoro", "dodoma"), "target","no_target")) %>% -->
<!--   mutate(target = ordered(target, levels = c("target", "no_target"))) %>% -->
<!--   arrange(target, desc(n)) -->

<!-- mrktregion_count %>%  -->
<!--   select(region.geomatch.final, target, n) %>%  -->
<!--   kable() -->

<!-- ``` -->

<!-- ### Surveys per Region (plot) -->
<!-- ```{r srvyregBar, echo = F} -->

<!-- srvyRegion_bar <- ggplot(mrktregion_count, aes(x = reorder(region.geomatch.final,-n), y=n))+ -->
<!--   geom_bar(stat = "identity",aes(fill = target, ), alpha = 0.75)+ -->
<!--   geom_text(aes(label=n), vjust=-1)+ -->
<!--   scale_fill_brewer(palette = "Set1", direction = -1)+ -->
<!--   labs(x="Region", y = "Number of Surveys", fill = "Target")+ -->
<!--   theme(axis.text.x = element_text(angle = -45, vjust=0, hjust=0)) -->

<!-- srvyRegion_bar -->
<!-- ``` -->

<!-- ## 4) Surveys per District {.tabset} -->

<!-- ```{r srvyDist, echo = F} -->

<!-- # Total Districts:  -->
<!-- tot_dist <- mrkta_info %>% distinct(district.geomatch.final) %>% nrow() -->
<!-- print(paste("There were ", tot_dist, "districts surveyed in total.")) -->
<!-- ``` -->

<!-- ### Districts per Region: -->
<!-- ```{r distperReg, echo = F} -->
<!-- mrkta_info %>% distinct(region.geomatch.final, district.geomatch.final) %>% group_by(region.geomatch.final) %>% count() %>% arrange(desc(n)) %>% kable() -->
<!-- ``` -->

<!-- ### Surveys per District: -->
<!-- ```{r mrktsperDist, echo = F} -->
<!-- mrktdist_count <- mrkta_info %>% group_by(region.geomatch.final, district.geomatch.final) %>% count() %>%  -->
<!--   mutate("target" = ifelse(`region.geomatch.final` %in% c("katavi", "simiyu", "mbeya", "mtwara", "morogoro", "dodoma"), "target","no_target")) %>% -->
<!--   mutate(target = ordered(target, levels = c("target", "no_target"))) %>% -->
<!--   arrange(target, desc(n)) -->

<!-- mrktdist_count %>%  -->
<!--   select(region.geomatch.final,  district.geomatch.final, target, n) %>%  -->
<!--   arrange(target, region.geomatch.final, n) %>% -->
<!--   kable() -->
<!-- ``` -->

<!-- ### Surveys per District (Plot): -->
<!-- ```{r mrktsDistPlot, echo = F} -->
<!-- srvyDist_bar <- ggplot(mrktdist_count, aes(x = reorder(district.geomatch.final,-n), y=n))+ -->
<!--   geom_bar(stat = "identity",aes(fill = target, ), alpha = 0.75)+ -->
<!--   geom_text(aes(label=n), vjust=-1)+ -->
<!--   scale_fill_brewer(palette = "Set1", direction = -1)+ -->
<!--   labs(x="District", y = "Number of Surveys", fill = "Target")+ -->
<!--   theme(axis.text.x = element_text(angle = -45, vjust=0, hjust=0)) -->

<!-- srvyDist_bar -->
<!-- ``` -->

<!-- ## 5) Surveys per Ward: {.tabset} -->
<!-- - A ward is the administrative level above a village, how many markets were surveyed in each Ward? -->
<!-- - In most wards only one market was surveyed -->

<!-- ```{r market_ward, echo = F, warning = F} -->
<!-- # Total Wards:  -->
<!-- tot_wards <- mrkta_info %>% distinct(ward.geomatch.final) %>% nrow() -->
<!-- print(paste("There were ", tot_wards, "wards surveyed in total.")) -->
<!-- ``` -->

<!-- ### Wards per Region: -->
<!-- ```{r wardsReg, echo = F} -->
<!-- mrkta_info %>% distinct(region.geomatch.final, district.geomatch.final, ward.geomatch.final) %>% group_by(region.geomatch.final) %>% count() %>% arrange(desc(n)) %>% kable() -->
<!-- ``` -->

<!-- ### Markets per Ward: -->
<!-- - Most wards are associated with only 1 market -->
<!-- - Wards with more than 1 market in Regions: Mtwara, Morogoro, Katavi -->
<!-- ```{r mrktPerWard, echo = F} -->
<!-- # Do any wards have more than 1 market? -->
<!-- multiwards <- mrkta_info %>%  -->
<!--   group_by(region.geomatch.final, ward.geomatch.final) %>%  -->
<!--   count() %>%  -->
<!--   filter(n>1) %>% -->
<!--   pull(ward.geomatch.final) -->

<!-- mrkta_info %>% filter(ward.geomatch.final %in% multiwards) %>%  -->
<!--   select(fid,date,region.geomatch.final,district.geomatch.final,ward.geomatch.final,village.manual.final,market.manual.final) %>% -->
<!--   arrange(ward.geomatch.final) %>% -->
<!--   kable() -->
<!-- ``` -->

<!-- ```{r mapMultiWards, include = F} -->

<!-- katavi_multiward<-ggplot() + -->
<!--   geom_sf(data = twards_shp %>% filter(Region_Nam %in% c("Katavi")), fill = "grey", alpha = 0.5, linewidth = 0.1) + -->
<!--   scale_fill_manual(values=rep(market_pal,2), guide = "none")+ -->
<!--   geom_sf(data = mrkta_sf %>% filter(region.geomatch.final == "katavi", ward.geomatch.final %in% multiwards), aes(col = ward.geomatch.final), size = 1.5)+ -->
<!--   scale_colour_manual(values = rep(market_pal,2))+ -->
<!--   facet_wrap(~Region_Nam)+ -->
<!--   coord_sf()+ -->
<!--   labs(title = "Market survey A locations",  -->
<!--        fill = "Tanzania region", -->
<!--        col = "Market region")+ -->
<!--   theme(legend.position = "right", legend.box = "horizontal") -->

<!-- morogoro_multiward <- ggplot() + -->
<!--   geom_sf(data = twards_shp %>% filter(Region_Nam %in% c("Morogoro")), fill = "grey", alpha = 0.5, linewidth = 0.1) + -->
<!--   scale_fill_manual(values=rep(market_pal,2), guide = "none")+ -->
<!--   geom_sf(data = mrkta_sf %>% filter(region.geomatch.final == "morogoro", ward.geomatch.final %in% multiwards), aes(col = ward.geomatch.final), size = 1.5)+ -->
<!--   scale_colour_manual(values = rep(market_pal,2))+ -->
<!--   facet_wrap(~Region_Nam)+ -->
<!--   coord_sf()+ -->
<!--   labs(title = "Market survey A locations",  -->
<!--        fill = "Tanzania region", -->
<!--        col = "Market region")+ -->
<!--   theme(legend.position = "right", legend.box = "horizontal") -->


<!-- mtwara_multiward <- ggplot() + -->
<!--   geom_sf(data = twards_shp %>% filter(Region_Nam %in% c("Mtwara")), fill = "grey", alpha = 0.5, linewidth = 0.1) + -->
<!--   scale_fill_manual(values=rep(market_pal,2), guide = "none")+ -->
<!--   geom_sf(data = mrkta_sf %>% filter(region.geomatch.final == "mtwara", ward.geomatch.final %in% multiwards), aes(col = ward.geomatch.final), size = 1.5)+ -->
<!--   scale_colour_manual(values = rep(market_pal,2))+ -->
<!--   facet_wrap(~Region_Nam)+ -->
<!--   coord_sf()+ -->
<!--   labs(title = "Market survey A locations",  -->
<!--        fill = "Tanzania region", -->
<!--        col = "Market region")+ -->
<!--   theme(legend.position = "right", legend.box = "horizontal") -->

<!-- ``` -->

<!-- ### Katavi Map -->

<!-- ```{r katavimultiward} -->
<!-- mrkta_info %>% filter(region.geomatch.final == "katavi", ward.geomatch.final %in% multiwards) -->
<!-- katavi_multiward -->
<!-- ``` -->

<!-- ### Morogoro Map -->

<!-- ```{r morogoromultiward} -->
<!-- morogoro_multiward -->
<!-- ``` -->

<!-- ### Mtwara Map -->

<!-- ```{r mtwaramultiward} -->
<!-- mtwara_multiward -->
<!-- ``` -->


<!-- ## 6) Type of Market -->

<!-- *All markets are given as Type 1: Primary Markets (note the buyer-seller questionnaire is not consistent with this)* -->

<!-- - Possible Market Type: -->
<!--   - *Primary market* - located close to the place of production or rearing of small ruminants, usually located within villages or small towns. -->
<!--   - *Secondary market* - usually found in suburbs, animals are transported some distance from their place of production/rearing to the market. -->
<!--   - *Tertiary or final consumption market* - generally located in towns or populated areas to supply urban populations, animals are transported quite a long-distance from their place of production/rearing. -->


<!-- ```{r market.type, echo = F} -->

<!-- ##################### -->
<!-- # markets by TYPE: -->
<!-- mrkta_info %>% -->
<!--   group_by(market.type) %>% -->
<!--   count() %>% -->
<!--   kable() # all markets are type 1 -->

<!-- ``` -->


<!-- ## 7) Small Ruminant Sales {.tabset} -->

<!-- ### Sheep and Goat sales per day -->
<!-- - The total number of sheep and goats sold across all markets -->
<!-- - NB: More goats sold than sheep. -->

<!-- ```{r tot_sales, echo = F} -->

<!-- sales <- mrkta_info %>% -->
<!--   mutate(SR.sales.day = `3a.no.sheep.sold.per.day`+`3b.no.goats.sold.per.day`) %>% -->
<!--   rename(sheep.sales.day =`3a.no.sheep.sold.per.day`, goat.sales.day =`3b.no.goats.sold.per.day`) %>% -->
<!--   select(fid,contains(".final"), contains(".sales")) %>% -->
<!--   gather(key = species, value = sales, -c(fid, region.geomatch.final, district.geomatch.final, ward.geomatch.final, village.manual.final, market.manual.final)) -->

<!-- # total reported sheep and goat sales per day of market -->
<!-- tot.sales <- sales %>% -->
<!--   group_by(species) %>% -->
<!--   summarise(tot = sum(sales)) %>% -->
<!--   arrange(tot) %>% -->
<!--   mutate(prop = round(tot/max(tot), digits = 2)) %>% -->
<!--   rename(Species = species, -->
<!--          Total_Sales = tot,  -->
<!--          Prop_Sales = prop) -->

<!-- kable(tot.sales) -->
<!-- ``` -->

<!-- ### All Sales Hist -->

<!-- ```{r allSales_hist, echo = F} -->

<!-- allSales_plot <- ggplot(sales %>% filter(species =="SR.sales.day"), aes(x=sales))+ -->
<!--   geom_histogram(aes(x=sales), binwidth = 10, alpha = 0.5, col = "black", boundary = 0)+ -->
<!--   scale_x_continuous(breaks = seq(0,650,50), labels = seq(0,650,50))+ -->
<!--   labs(x = "All Small Ruminant Sales per Day", -->
<!--        y = "Count", -->
<!--        main = "All Small Ruminant Sales per Day") -->
<!-- allSales_plot -->
<!-- ``` -->

<!-- ### Sales by Species -->
<!-- ```{r spSales_hist, echo = F} -->
<!-- spSales_plot <- ggplot(sales %>% filter(species!="SR.sales.day"), aes(x=sales, group = species, fill = species))+ -->
<!--   geom_histogram(aes(x=sales), binwidth = 10, alpha = 0.5, col = "black", boundary = 0, position = "dodge")+ -->
<!--   scale_x_continuous(breaks = seq(0,650,50), labels = seq(0,650,50))+ -->
<!--   labs(x = "Sales per Day", -->
<!--        y = "Count", -->
<!--        main = "Sales per Day")+ -->
<!--   facet_wrap(~species) -->
<!-- spSales_plot -->
<!-- ``` -->

<!-- ### Species sales correlation -->
<!-- ```{r spSales_scatter, echo = F} -->
<!-- shgt_scatter <- ggplot(mrkta_info, -->
<!--                        aes(x = `3a.no.sheep.sold.per.day`, -->
<!--                            y = `3b.no.goats.sold.per.day`)) + -->
<!--   geom_point(aes(col = region.geomatch.final)) + -->
<!--   scale_colour_manual(values = rep(market_pal,2))+ -->
<!--   labs(x = "Sheep sales per day", -->
<!--        y = "Goat sales per day") -->
<!-- shgt_scatter -->
<!-- ``` -->

<!-- ## 8) Small Ruminant Sales by Region {.tabset} -->

<!-- ### Sales-Region (table) -->
<!-- ```{r salesReg, echo = F} -->
<!-- sales %>%  -->
<!--   filter(species == "SR.sales.day") %>% -->
<!--   group_by(region.geomatch.final) %>% -->
<!--   summarise( -->
<!--     markets = n(), -->
<!--     median = median(sales),  -->
<!--     mean = mean(sales),  -->
<!--     min = min(sales),  -->
<!--     max = max(sales),  -->
<!--   ) %>%  -->
<!--   kable() -->
<!-- ``` -->

<!-- ### Sales-Region (boxplot) -->
<!-- ```{r salesRegBox, echo = F} -->

<!-- # function for number of observations  -->
<!-- give.n <- function(x){ -->
<!--   return(c(y = max(x)*1.1, label = length(x)))  -->
<!--   # experiment with the multiplier to find the perfect position -->
<!-- } -->

<!-- # plot -->

<!-- ggplot(sales %>% filter(species == "SR.sales.day"), -->
<!--        # reorder(Species, Sepal.Width, FUN = median) -->
<!--        aes(x=reorder(region.geomatch.final,-sales,FUN=median, desc.=F), y=sales))+ -->
<!--   geom_boxplot(aes(fill = region.geomatch.final), alpha = 0.5)+ -->
<!--   geom_jitter(position = position_dodge(width = 0))+ -->
<!--   scale_fill_manual(values = rep(market_pal,2))+ -->
<!--   stat_summary(fun.data = give.n, geom = "text", fun.y = max)+ -->
<!--   labs(x="Region", y = "Small ruminant sales")+ -->
<!--   theme(axis.text.x = element_text(angle = 45, hjust = 1), -->
<!--         legend.position = "none") -->

<!-- ``` -->

<!-- ### Sales-Region (histogram) -->
<!-- ```{r salesRegBar, echo = F} -->

<!-- ggplot(sales %>% filter(species =="SR.sales.day"), aes(x=sales, group = region.geomatch.final, fill = region.geomatch.final))+ -->
<!--   geom_histogram(aes(x=sales), binwidth = 10, alpha = 0.5, col = "black", boundary = 0)+ -->
<!--   scale_x_continuous(breaks = seq(0,650,50), labels = seq(0,650,50))+ -->
<!--   facet_wrap(~region.geomatch.final, ncol = 3)+ -->
<!--   scale_fill_manual(values = rep(market_pal,2))+ -->
<!--   labs(x = "All Small Ruminant Sales per Day", -->
<!--        y = "Count", -->
<!--        main = "All Small Ruminant Sales per Day")+ -->
<!--   theme(legend.position = "none") -->

<!-- ``` -->

<!-- ## 9) Small Ruminant trade patterns: {.tabset} -->

<!-- ### Seasonal Variation in Trade -->

<!-- ```{r seasonal_trade, echo = F} -->

<!-- mrkta_info %>% -->
<!--   group_by(`4.seasonal.variation.in.trade`) %>% -->
<!--   count() %>% -->
<!--   mutate( -->
<!--     YN = ifelse(`4.seasonal.variation.in.trade` == 0, "N", "Y"), -->
<!--     proportion = round(n/nrow(mrkta_info), digits = 2)) %>% -->
<!--   ungroup() %>% -->
<!--   select("Seasonal trade" = YN, "Number markets" =n, "Proportion markets" =proportion) %>% -->
<!--   kable() -->
<!-- ``` -->

<!-- ### Seasonal Trade Patterns -->
<!-- - *Translate the below* -->
<!-- ```{r seasonal_trade_ans, echo = F, warning = F} -->
<!-- # translate this: -->
<!-- mrkta_info %>% filter(`4.seasonal.variation.in.trade` ==1) %>% select(`4.if.yes.describe`) %>% head(n=4) %>% kable() -->
<!-- ``` -->

<!-- ### Origins and Destinations -->

<!-- ```{r buysell_location, echo = F, warning=F} -->
<!-- # colnames(mrkta_info) -->

<!-- mrkta_info %>% -->
<!--   select(fid, market.manual.final,`1.location.brought.from`, `2.location.taken.to.`) %>% head() %>% knitr::kable() -->

<!-- ``` -->

